#include <stdio.h>

#include "indoor_outdoor_recognizer.c"


void output_gpgsv_info(MIIndoorOutdoorRecognizer *recognizer, uint8_t print_snr) {
    if (print_snr == 1) {
        printf("snrs = ");
        for(uint8_t i = 0; i < 32; ++i) {
            printf("%d ", recognizer->snrs[i]);
        }
        printf("\n");
    }

    printf("update_timestamp_ms, sat_cnt, sat_snr_sum, indoor_outdoor_status= %ld, %d, %d, %d\n\n",
        recognizer->update_timestamp_ms,
        recognizer->sat_cnt,
        recognizer->sat_snr_sum,
        recognizer->status);

}

char nmea_sentences[][100] =
{"1606963479251,1606963478745,$PQGSV,4,1,14,01,34,139,,02,33,224,44,03,43,188,,04,24,123,,1*7E\r\n",
"1606963479252,1606963478745,$PQGSV,4,2,14,05,16,248,44,06,78,268,44,07,00,000,,08,52,170,,1*76\r\n",
"1606963479253,1606963478745,$PQGSV,4,3,14,09,50,240,,10,00,000,,12,09,323,,13,70,209,,1*7D\r\n",
"1606963479254,1606963478745,$PQGSV,4,4,14,16,73,262,,19,00,000,,1*7A\r\n",
"1606963479254,1606963478745,$PQGSV,1,1,0,4*47\r\n",
"1606963479255,1606963478783,$GPGSA,A,1,,,,,,,,,,,,,,,*1E\r\n",
"1606963479256,1606963478783,$GNGSA,A,1,,,,,,,,,,,,,,,*00\r\n",
"1606963479257,1606963478783,$PQGSA,A,1,,,,,,,,,,,,,,,*08\r\n",
"1606963479257,1606963478783,$GPVTG,,T,,M,,N,,K,N*2C\r\n",
"1606963479258,1606963478783,$GPRMC,,V,,,,,,,,,,N,V*29\r\n",
"1606963479259,1606963478783,$GPGGA,,,,,,0,,,,,,,,*66\r\n",
"1606963480114,1606963479738,$GPGSV,2,1,07,05,09,111,44,08,00,000,44,10,21,300,44,12,00,000,,1*67\r\n",
"1606963480127,1606963479738,$PQGSV,4,1,14,01,34,139,,02,33,224,,03,43,188,,04,24,123,,1*7E\r\n",
"1606963480115,1606963479738,$GPGSV,2,2,07,13,26,052,,14,01,039,,15,61,043,,1*58\r\n",
"1606963480115,1606963479738,$GPGSV,1,1,0,8*5D\r\n",
"1606963480116,1606963479738,$GLGSV,3,1,12,78,37,108,,70,00,000,,82,00,000,,77,26,043,,1*75\r\n",
"1606963480117,1606963479738,$GLGSV,3,2,12,76,00,000,,79,11,157,,69,35,298,,84,40,295,,1*7A\r\n",
"1606963480117,1606963479738,$GLGSV,3,3,12,83,30,217,,85,04,341,,67,19,070,,68,55,016,,1*7F\r\n",
"1606963480118,1606963479738,$GLGSV,1,1,0,3*4A\r\n",
"1606963480118,1606963479738,$GAGSV,1,1,0,7*43\r\n",
"1606963480119,1606963479738,$GAGSV,1,1,0,1*45\r\n",
"1606963480120,1606963479738,$PQGSV,1,1,03,193,64,084,,194,24,137,,195,06,171,,1*77\r\n",
"1606963480121,1606963479738,$PQGSV,1,1,0,8*4B\r\n",
"1606963480127,1606963479738,$PQGSV,4,2,14,05,16,248,,06,78,268,,07,00,000,,08,52,170,,1*76\r\n",
"1606963480128,1606963479738,$PQGSV,4,3,14,09,50,240,,10,00,000,,12,09,323,,13,70,209,,1*7D\r\n",
"1606963480128,1606963479738,$PQGSV,4,4,14,16,73,262,,19,00,000,,1*7A\r\n",
"1606963480129,1606963479738,$PQGSV,1,1,0,4*47\r\n",
"1606963480130,1606963479753,$GPGSA,A,1,,,,,,,,,,,,,,,*1E\r\n",
"1606963480131,1606963479753,$GNGSA,A,1,,,,,,,,,,,,,,,*00\r\n",
"1606963480132,1606963479753,$PQGSA,A,1,,,,,,,,,,,,,,,*08\r\n",
"1606963480133,1606963479753,$GPVTG,,T,,M,,N,,K,N*2C\r\n",
"1606963480133,1606963479753,$GPRMC,,V,,,,,,,,,,N,V*29\r\n",
"1606963480134,1606963479753,$GPGGA,,,,,,0,,,,,,,,*66\r\n",
"1606963480784,1606963480738,$GPGSV,2,1,07,05,09,111,,08,00,000,,10,21,300,,12,00,000,,1*67\r\n",
"1606963480785,1606963480738,$GPGSV,2,2,07,13,26,052,,14,01,039,,15,61,043,,1*58\r\n",
"1606963480785,1606963480738,$GPGSV,1,1,0,8*5D\r\n",
"1606963481193,1606963480738,$GLGSV,3,1,12,78,37,108,,70,00,000,,82,00,000,,77,26,043,,1*75\r\n",
"1606963481195,1606963480738,$GLGSV,3,2,12,76,00,000,,79,11,157,,69,35,298,,84,40,295,,1*7A\r\n",
"1606963481195,1606963480738,$GLGSV,3,3,12,83,30,217,,85,04,341,,67,19,070,,68,55,016,,1*7F\r\n",
"1606963481196,1606963480738,$GLGSV,1,1,0,3*4A\r\n",
"1606963481197,1606963480738,$GAGSV,1,1,0,7*43\r\n",
"1606963481197,1606963480738,$GAGSV,1,1,0,1*45\r\n",
"1606963481198,1606963480738,$PQGSV,1,1,03,193,64,084,,194,24,137,,195,06,171,,1*77\r\n",
"1606963481199,1606963480738,$PQGSV,1,1,0,8*4B\r\n",
"1606963481199,1606963480738,$PQGSV,4,1,14,01,34,139,,02,33,224,,03,43,188,,04,24,123,,1*7E\r\n",
"1606963481200,1606963480738,$PQGSV,4,2,14,05,16,248,,06,78,268,,07,00,000,,08,52,170,,1*76\r\n",
"1606963481200,1606963480738,$PQGSV,4,3,14,09,50,240,,10,00,000,,12,09,323,,13,70,209,,1*7D\r\n",
"1606963481206,1606963480738,$PQGSV,4,4,14,16,73,262,,19,00,000,,1*7A\r\n",
"1606963481207,1606963480738,$PQGSV,1,1,0,4*47\r\n",
"1606963481208,1606963480753,$GPGSA,A,1,,,,,,,,,,,,,,,*1E\r\n",
"1606963481208,1606963480753,$GNGSA,A,1,,,,,,,,,,,,,,,*00\r\n",
"1606963481209,1606963480753,$PQGSA,A,1,,,,,,,,,,,,,,,*08\r\n",
"1606963481210,1606963480753,$GPVTG,,T,,M,,N,,K,N*2C\r\n",
"1606963481210,1606963480753,$GPRMC,,V,,,,,,,,,,N,V*29\r\n",
"1606963481240,1606963480753,$GPGGA,,,,,,0,,,,,,,,*66\r\n",
"1606963482318,1606963481749,$GPGSV,2,1,07,07,09,111,33,09,00,000,33,12,21,300,33,13,00,000,33,1*67\r\n",
"1606963482319,1606963481749,$GPGSV,2,2,07,13,26,052,,14,01,039,,15,61,043,,1*58\r\n",
"1606963482320,1606963481749,$GPGSV,1,1,0,8*5D\r\n",
"1606963482320,1606963481749,$GLGSV,3,1,12,78,37,108,,70,00,000,,82,00,000,,77,26,043,,1*75\r\n",
"1606963482321,1606963481749,$GLGSV,3,2,12,76,00,000,,79,11,157,,69,35,298,,84,40,295,,1*7A\r\n",
"1606963482322,1606963481749,$GLGSV,3,3,12,83,30,217,,85,04,341,,67,19,070,,68,55,016,,1*7F\r\n",
"1606963482323,1606963481749,$GLGSV,1,1,0,3*4A\r\n",
"1606963482323,1606963481749,$GAGSV,1,1,0,7*43\r\n",
"1606963482324,1606963481749,$GAGSV,1,1,0,1*45\r\n",
"1606963482325,1606963481749,$PQGSV,1,1,03,193,64,084,,194,24,137,,195,06,171,,1*77\r\n",
"1606963482325,1606963481749,$PQGSV,1,1,0,8*4B\r\n",
"1606963482326,1606963481749,$PQGSV,4,1,14,01,34,139,,02,33,224,,03,43,188,,04,24,123,,1*7E\r\n",
"1606963482327,1606963481749,$PQGSV,4,2,14,05,16,248,,06,78,268,,07,00,000,,08,52,170,,1*76\r\n",
"1606963482327,1606963481749,$PQGSV,4,3,14,09,50,240,,10,00,000,,12,09,323,,13,70,209,,1*7D\r\n",
"1606963482328,1606963481749,$PQGSV,4,4,14,16,73,262,,19,00,000,,1*7A\r\n",
"1606963482329,1606963481749,$PQGSV,1,1,0,4*47\r\n",
"1606963482329,1606963481796,$GPGSA,A,1,,,,,,,,,,,,,,,*1E\r\n",
"1606963482330,1606963481796,$GNGSA,A,1,,,,,,,,,,,,,,,*00\r\n",
"1606963482330,1606963481796,$PQGSA,A,1,,,,,,,,,,,,,,,*08\r\n",
"1606963482331,1606963481796,$GPVTG,,T,,M,,N,,K,N*2C\r\n",
"1606963482332,1606963481796,$GPRMC,,V,,,,,,,,,,N,V*29\r\n",
"1606963482333,1606963481796,$GPGGA,,,,,,0,,,,,,,,*66\r\n",
"1606963483016,1606963482738,$GPGSV,2,1,07,05,09,111,,08,00,000,,10,21,300,,12,00,000,,1*67\r\n",
"1606963483022,1606963482738,$GPGSV,2,2,07,13,26,052,,14,01,039,,15,61,043,,1*58\r\n",
"1606963483023,1606963482738,$GPGSV,1,1,0,8*5D\r\n",
"1606963483023,1606963482738,$GLGSV,3,1,12,78,37,108,,70,00,000,,82,00,000,,77,26,043,,1*75\r\n",
"1606963483024,1606963482738,$GLGSV,3,2,12,76,00,000,,79,11,157,,69,35,298,,84,40,295,,1*7A\r\n",
"1606963483025,1606963482738,$GLGSV,3,3,12,83,30,217,,85,04,341,,67,19,070,,68,55,016,,1*7F\r\n"};

int main() {
    MIIndoorOutdoorRecognizer *recognizer = mi_indoor_outdoor_recognizer_new();
    mi_indoor_outdoor_recognizer_init(recognizer);

    for(uint8_t i = 0; i < 100; ++i) {
        char *gpgsv_sentences = strstr((const char*)nmea_sentences[i], "$GPGSV");
        if(gpgsv_sentences == NULL) continue;
        printf("gpgsv_sentence = %s", gpgsv_sentences);
        mi_indoor_outdoor_recognizer_process_nmea_str(recognizer, nmea_sentences[i]);
        output_gpgsv_info(recognizer, 0);
    }
    return 0;
}
